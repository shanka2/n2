<% include ../__include/__top.ejs %>
<link rel="stylesheet" href="<%- $$._path(__filename)("css") %>">


<table>
    <tr>
        <td>name</td>
        <td><input type="text" v-model="form.name"></td>
    </tr>
    <tr>
        <td>price</td>
        <td><input type="text" v-model="form.price"></td>
    </tr>
    <tr>
        <td>description</td>
        <td><input type="text" v-model="form.description"></td>
    </tr>
</table>

<table>
    <tr>
        <td><input type="text" v-model="form.opt1_name"></td>
        <td><input type="text" v-model="form.opt2_name"></td>
        <td><button @click="_opt_add">+</button></td>
    </tr>
    <tr v-for="(v, k) in form.opt">
        <td><input type="text" v-model="v.opt1"></td>
        <td><input type="text" v-model="v.opt2"></td>
        <td><button @click="_opt_remove(k)">-</button></td>
    </tr>
</table>


<input type="file" multiple @change="_preview" id="_f" v-if="form.name">

<div v-for="f in files" id="_files">
    <div><img :src="f.url" :alt="f.name">{{f.name}}</div>
</div>


<button onclick="tableToExcel('product_list')">tableToExcel</button>
<button @click="_exec('insert')">insert</button>
<button @click="_exec('update')" v-if="form.idx">update</button>
<button @click="_exec('delete')" v-if="form.idx">delete</button>

<br>

<input type="text" v-model='s_value' @keypress.enter='_search(s_value)'>
<span @click="_search('')" v-if="x.qs.s_value">{{x.qs.s_value}}</span>



<table class="_table_100 _excel">
    <thead>
        <td width="10%">NO</td>
        <td width="15%" class="_no_excel">IMG</td>
        <td width="30%">PRODUCT NAME</td>
        <td width="30%">OPTION</td>
        <td width="15%">PRICE</td>
    </thead>
    
    <template v-for="(m, n) in _.uniq(r, 'idx')">
        <tr class="list_value" :idx="m.idx">
            <td :rowspan="m.row_cnt">{{$p.no($p,n)}}</td>
            <td :rowspan="m.row_cnt" class="_no_excel"><img v-for="(img, i) in (m.imgs || '').split(',')" :src="'/upload/thumb/100/' + img" :alt="m.idx + ':' + i" v-if="m.imgs"></td>
            <td :rowspan="m.row_cnt" class="_left" :title="m.idx" @click="_info(m.idx)">{{m.name}}</td>
            <td class="_left">{{m.opt1}}</td>
            <td :rowspan="m.row_cnt" class="_right">{{m.price}}</td>
        </tr>
        <tr class="list_value_sub" v-if="m.row_cnt > 1" v-for="s in r.filter(i => i.idx == m.idx).slice(1)">
            <td class="_left">{{s.opt1}}</td>
        </tr>
    </template>
</table>

<div v-if="!_.isEmpty($p)">
    <span v-if="$p.prev_page" @click="_page($p.prev_page)">prev</span>
    <span v-for="n in $p.now_block_size" :class="{_selected: ($p.p_no($p,n) == $p.now_page)}" @click='_page($p.p_no($p,n))'> {{$p.p_no($p,n)}} </span>
    <span v-if="$p.next_page" @click="_page($p.next_page)">next</span>
    <select v-model="$p.page_size" @change="_page(1, $p.page_size)">
        <option v-for="v in $p.page_size_list">{{v}}</option>
    </select>
    
    <!--
    {{$p.page_size}}
    <br><br>
    <div v-for="n in $p.now_page_size" v-if="$p.no($p,n-1) > 0">NO. {{$p.no($p,n-1)}}</div>
    -->
</div>

<% include ../__include/__bottom.ejs %>
<script src="<%- $$._path(__filename)("js") %>"></script>



